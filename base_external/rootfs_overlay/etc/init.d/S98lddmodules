#!/bin/sh

case "$1" in
    start)
        echo "S98lddmodules: loading LDD modules..."

        if [ -x /usr/bin/scull_load ]; then
            /usr/bin/scull_load || echo "scull_load failed"
        else
            echo "scull_load script not found!"
        fi

        if [ -x /usr/bin/module_load ]; then
            /usr/bin/module_load || echo "module_load (faulty) failed"
        else
            echo "module_load script not found!"
        fi

        if command -v modprobe >/dev/null 2>&1; then
            modprobe hello || echo "modprobe hello failed"
        else
            echo "modprobe not found!"
        fi
        ;;
    stop)
        echo "S98lddmodules: unloading LDD modules..."

        if command -v rmmod >/dev/null 2>&1; then
            rmmod hello 2>/dev/null || echo "rmmod hello failed"
        fi

        if [ -x /usr/bin/module_unload ]; then
            /usr/bin/module_unload || echo "module_unload (faulty) failed"
        else
            echo "module_unload script not found!"
        fi

        if [ -x /usr/bin/scull_unload ]; then
            /usr/bin/scull_unload || echo "scull_unload failed"
        else
            echo "scull_unload script not found!"
        fi
        ;;
    restart)
        "$0" stop
        "$0" start
        ;;

    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac

exit 0
